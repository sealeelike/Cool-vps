<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tool</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #fcfcfc; font-family: sans-serif; }
        .container-box { background: white; border: 1px solid #eee; border-radius: 8px; }
    </style>
</head>
<body class="p-4 md:p-12">
    <div class="max-w-3xl mx-auto">
        <div class="space-y-4">
            <!-- Input Area -->
            <div class="container-box p-4">
                <textarea id="rawInput" rows="6" class="w-full p-2 border border-gray-200 rounded outline-none text-sm" placeholder="一行一个"></textarea>
            </div>

            <!-- Action -->
            <div class="flex gap-2">
                <button onclick="process()" class="flex-1 bg-gray-800 hover:bg-black text-white py-2 px-4 rounded transition-all">
                    立即转换
                </button>
                <button onclick="copyResult()" id="copyBtn" class="bg-gray-100 hover:bg-gray-200 text-gray-700 py-2 px-4 rounded hidden">
                    复制
                </button>
            </div>

            <!-- Output Area -->
            <div id="resultContainer" class="container-box p-4 hidden">
                <pre id="resultOutput" class="bg-gray-50 p-3 rounded overflow-x-auto text-xs text-gray-600 leading-relaxed"></pre>
            </div>
        </div>
    </div>

    <script>
        function process() {
            const input = document.getElementById('rawInput').value.trim();
            if (!input) return;

            const lines = input.split('\n');
            const data = [];

            lines.forEach(line => {
                try {
                    const str = line.trim();
                    if (!str.includes('://')) return;

                    const url = new URL(str);
                    const label = decodeURIComponent(url.hash.substring(1)) || 'Item';
                    const id = url.username;
                    const host = url.hostname;
                    const port = url.port;
                    const params = url.searchParams;

                    const item = {
                        name: label,
                        type: 'vless',
                        server: host,
                        port: parseInt(port),
                        uuid: id,
                        udp: true,
                        tls: true,
                        flow: params.get('flow') || 'xtls-rprx-vision',
                        'skip-cert-verify': false,
                        servername: params.get('sni') || '',
                        network: params.get('type') || 'tcp',
                        'reality-opts': {
                            'public-key': params.get('pbk') || '',
                            'short-id': params.get('sid') || ''
                        },
                        'client-fingerprint': params.get('fp') || 'firefox'
                    };

                    const formatted = `- {name: "${item.name}", type: ${item.type}, server: ${item.server}, port: ${item.port}, uuid: ${item.uuid}, udp: ${item.udp}, tls: ${item.tls}, flow: ${item.flow}, skip-cert-verify: ${item['skip-cert-verify']}, servername: ${item.servername}, network: ${item.network}, reality-opts: {public-key: ${item['reality-opts']['public-key']}, short-id: ${item['reality-opts']['short-id']}}, client-fingerprint: ${item['client-fingerprint']}}`;
                    data.push(formatted);
                } catch (e) {}
            });

            if (data.length > 0) {
                document.getElementById('resultOutput').textContent = data.join('\n');
                document.getElementById('resultContainer').classList.remove('hidden');
                document.getElementById('copyBtn').classList.remove('hidden');
            }
        }

        function copyResult() {
            const content = document.getElementById('resultOutput').textContent;
            const el = document.createElement("textarea");
            el.value = content;
            document.body.appendChild(el);
            el.select();
            document.execCommand("copy");
            document.body.removeChild(el);
            
            const btn = document.getElementById('copyBtn');
            btn.innerText = "OK";
            setTimeout(() => { btn.innerText = "复制"; }, 1500);
        }
    </script>
</body>
</html>
